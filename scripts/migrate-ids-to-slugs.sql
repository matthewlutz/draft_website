-- Migrate old numeric prospect IDs to stable slug strings
-- Run this in Supabase SQL Editor (Dashboard > SQL Editor)

-- Step 1: Create the old-rank-to-slug mapping table (all 500 players)
CREATE TEMP TABLE id_map (old_id integer, slug text);
INSERT INTO id_map VALUES
  (1,'fernando-mendoza'),
  (2,'caleb-downs'),
  (3,'rueben-bain-jr'),
  (4,'arvell-reese'),
  (5,'peter-woods'),
  (6,'francis-mauigoa'),
  (7,'keldric-faulk'),
  (8,'spencer-fano'),
  (9,'jordyn-tyson'),
  (10,'jeremiyah-love'),
  (11,'jermod-mccoy'),
  (12,'carnell-tate'),
  (13,'mansoor-delane'),
  (14,'makai-lemon'),
  (15,'avieon-terrell'),
  (16,'tj-parker'),
  (17,'cashius-howell'),
  (18,'david-bailey'),
  (19,'denzel-boston'),
  (20,'kevin-concepcion'),
  (21,'kadyn-proctor'),
  (22,'olaivavega-ioane'),
  (23,'cj-allen'),
  (24,'kenyon-sadiq'),
  (25,'ty-simpson'),
  (26,'lt-overton'),
  (27,'christen-miller'),
  (28,'sonny-styles'),
  (29,'caleb-lomu'),
  (30,'colton-hood'),
  (31,'romello-height'),
  (32,'dani-dennis-sutton'),
  (33,'gabe-jacas'),
  (34,'chris-bell'),
  (35,'anthony-hill-jr'),
  (36,'caleb-banks'),
  (37,'brandon-cisse'),
  (38,'kayden-mcdonald'),
  (39,'dillon-thieneman'),
  (40,'isaiah-world'),
  (41,'zachariah-branch'),
  (42,'domonique-orange'),
  (43,'eli-stowers'),
  (44,'lee-hunter'),
  (45,'monroe-freeling'),
  (46,'dangelo-ponds'),
  (47,'joshua-josephs'),
  (48,'kamari-ramsey'),
  (49,'gennings-dunker'),
  (50,'deontae-lawson'),
  (51,'r-mason-thomas'),
  (52,'akheem-mesidor'),
  (53,'harold-perkins-jr'),
  (54,'emmanuel-mcneil-warren'),
  (55,'taurean-york'),
  (56,'jakobi-lane'),
  (57,'emmanuel-pregnon'),
  (58,'davison-igbinosun'),
  (59,'keith-abney-ii'),
  (60,'zion-young'),
  (61,'tyreak-sapp'),
  (62,'malik-muhammad'),
  (63,'elijah-sarratt'),
  (64,'zxavian-harris'),
  (65,'connor-lew'),
  (66,'derrick-moore'),
  (67,'domani-jackson'),
  (68,'jake-slaughter'),
  (69,'germie-bernard'),
  (70,'jonah-coleman'),
  (71,'carson-beck'),
  (72,'chris-johnson'),
  (73,'malachi-fields'),
  (74,'jacob-rodriguez'),
  (75,'caleb-tiernan'),
  (76,'blake-miller'),
  (77,'daylen-everette'),
  (78,'garrett-nussmeier'),
  (79,'michael-taaffe'),
  (80,'bud-clark'),
  (81,'max-klare'),
  (82,'julian-neal'),
  (83,'kyle-louis'),
  (84,'kaytron-allen'),
  (85,'chris-brazzell-ii'),
  (86,'austin-barber'),
  (87,'antonio-williams'),
  (88,'chase-bisontis'),
  (89,'drew-allar'),
  (90,'kevin-coleman-jr'),
  (91,'aj-haulcy'),
  (92,'michael-trigg'),
  (93,'jake-golday'),
  (94,'deion-burks'),
  (95,'brian-parker-ii'),
  (96,'max-iheanachor'),
  (97,'zane-durant'),
  (98,'darrell-jackson-jr'),
  (99,'josiah-trotter'),
  (100,'dontay-corleone'),
  (101,'trinidad-chambliss'),
  (102,'rayshaun-benny'),
  (103,'lander-barton'),
  (104,'omar-cooper-jr'),
  (105,'jadarian-price'),
  (106,'tim-keenan-iii'),
  (107,'kevin-coleman-jr'),
  (108,'brian-parker-ii'),
  (109,'max-llewellyn'),
  (110,'cade-klubnik'),
  (111,'nick-singleton'),
  (112,'demond-claiborne'),
  (113,'logan-jones'),
  (114,'chase-bisontis'),
  (115,'chandler-rivers'),
  (116,'malachi-fields'),
  (117,'jacob-rodriguez'),
  (118,'armaj-reed-adams'),
  (119,'tj-hall'),
  (120,'blake-miller'),
  (121,'tj-guy'),
  (122,'kage-casey'),
  (123,'parker-brailsford'),
  (124,'aaron-anderson'),
  (125,'beau-stephens'),
  (126,'jalen-huskey'),
  (127,'bishop-fitzgerald'),
  (128,'trey-moore'),
  (129,'oscar-delp'),
  (130,'dj-campbell'),
  (131,'jude-bowry'),
  (132,'josh-moten'),
  (133,'eric-rivers'),
  (134,'emmett-johnson'),
  (135,'drew-shelton'),
  (136,'daequan-wright'),
  (137,'jaishawn-barham'),
  (138,'albert-regis'),
  (139,'jmari-taylor'),
  (140,'jc-davis'),
  (141,'cj-daniels'),
  (142,'aaron-graves'),
  (143,'jimmy-rolder'),
  (144,'jaeden-roberts'),
  (145,'deshon-singleton'),
  (146,'will-lee-iii'),
  (147,'leveon-moss'),
  (148,'bryce-boettcher'),
  (149,'taylen-green'),
  (150,'louis-moore'),
  (151,'trey-zuhn-iii'),
  (152,'aiden-fisher'),
  (153,'collin-wright'),
  (154,'malachi-lawrence'),
  (155,'ted-hurst'),
  (156,'chase-roberts'),
  (157,'roman-hemby'),
  (158,'kahlil-benson'),
  (159,'justin-joly'),
  (160,'stephen-daley'),
  (161,'thaddeus-dixon'),
  (162,'riley-nowakowski'),
  (163,'hezekiah-masses'),
  (164,'isaiah-smith'),
  (165,'skyler-bell'),
  (166,'nadame-tucker'),
  (167,'keanu-tanuvasa'),
  (168,'ephesians-prysock'),
  (169,'josh-cameron'),
  (170,'joe-royer'),
  (171,'sawyer-robertson'),
  (172,'bryce-foster'),
  (173,'kyle-louis'),
  (174,'seth-mcgowan'),
  (175,'vj-payne'),
  (176,'jam-miller'),
  (177,'keylan-rutledge'),
  (178,'terion-stewart'),
  (179,'keyron-crawford'),
  (180,'keagen-trost'),
  (181,'colbie-young'),
  (182,'justin-jefferson'),
  (183,'ethan-burke'),
  (184,'connor-tollison'),
  (185,'max-iheanachor'),
  (186,'deven-eastern'),
  (187,'noah-whittington'),
  (188,'zakee-wheatley'),
  (189,'tanner-koziol'),
  (190,'bryan-thomas-jr'),
  (191,'jakobe-thomas'),
  (192,'camron-stewart'),
  (193,'chris-mcclellan'),
  (194,'skyler-gill-howard'),
  (195,'kaleb-proctor'),
  (196,'harrison-wallace-iii'),
  (197,'cameron-ball'),
  (198,'josh-thompson'),
  (199,'diego-pavia'),
  (200,'barion-brown'),
  (201,'hezekiah-masses'),
  (202,'kelley-jones'),
  (203,'trinidad-chambliss'),
  (204,'peter-clarke'),
  (205,'isaiah-smith'),
  (206,'skyler-bell'),
  (207,'nadame-tucker'),
  (208,'keanu-tanuvasa'),
  (209,'phillip-daniels'),
  (210,'ephesians-prysock'),
  (211,'omega-blake'),
  (212,'josh-cameron'),
  (213,'joe-royer'),
  (214,'earl-little-jr'),
  (215,'sawyer-robertson'),
  (216,'niki-prongos'),
  (217,'ernest-hausmann'),
  (218,'bryce-foster'),
  (219,'kyle-louis'),
  (220,'cj-daniels'),
  (221,'vj-payne'),
  (222,'jam-miller'),
  (223,'matt-gulbin'),
  (224,'keylan-rutledge'),
  (225,'deandre-moore-jr'),
  (226,'rodrick-pleasant'),
  (227,'darius-taylor'),
  (228,'xavier-nwankpa'),
  (229,'terion-stewart'),
  (230,'brice-pollock'),
  (231,'keyron-crawford'),
  (232,'keagen-trost'),
  (233,'colbie-young'),
  (234,'christian-gray'),
  (235,'tate-sandell'),
  (236,'justin-jefferson'),
  (237,'isaiah-horton'),
  (238,'ethan-burke'),
  (239,'evan-stewart'),
  (240,'connor-tollison'),
  (241,'max-iheanachor'),
  (242,'deven-eastern'),
  (243,'noah-whittington'),
  (244,'zakee-wheatley'),
  (245,'tanner-koziol'),
  (246,'bryan-thomas-jr'),
  (247,'jakobe-thomas'),
  (248,'camron-stewart'),
  (249,'chris-mcclellan'),
  (250,'skyler-gill-howard'),
  (251,'jalen-catalon'),
  (252,'kaleb-proctor'),
  (253,'harrison-wallace-iii'),
  (254,'cameron-ball'),
  (255,'josh-gesky'),
  (256,'diego-pavia'),
  (257,'carson-hinzman'),
  (258,'barion-brown'),
  (259,'pat-coogan'),
  (260,'bryson-washington'),
  (261,'keyshaun-elliott'),
  (262,'anez-cooper'),
  (263,'john-nestor'),
  (264,'west-weeks'),
  (265,'charles-demmings'),
  (266,'will-whitson'),
  (267,'jalon-kilgore'),
  (268,'kendal-daniels'),
  (269,'bud-clark'),
  (270,'logan-fano'),
  (271,'red-murdock'),
  (272,'brandon-cleveland'),
  (273,'terry-moore'),
  (274,'brent-austin'),
  (275,'dametrious-crownover'),
  (276,'wesley-williams'),
  (277,'jadon-canady'),
  (278,'gary-smith-iii'),
  (279,'rahsul-faison'),
  (280,'marques-white'),
  (281,'desmond-purnell'),
  (282,'kwabena-asamoah'),
  (283,'ahmari-harvey'),
  (284,'sam-roush'),
  (285,'cyrus-allen'),
  (286,'drew-bobo'),
  (287,'mike-washington-jr'),
  (288,'reggie-virgil'),
  (289,'drayk-bowen'),
  (290,'namdi-obiazor'),
  (291,'sam-hecht'),
  (292,'tyler-onyedim'),
  (293,'jaren-kump'),
  (294,'nate-boerkircher'),
  (295,'kemari-copeland'),
  (296,'logan-taylor'),
  (297,'wes-pahl'),
  (298,'damari-brown'),
  (299,'ryan-baer'),
  (300,'malik-spencer'),
  (301,'george-gumbs'),
  (302,'bryson-eason'),
  (303,'gracen-halton'),
  (304,'enrique-cruz-jr'),
  (305,'diego-pounds'),
  (306,'adam-randall'),
  (307,'nick-dawkins'),
  (308,'owen-heinecke'),
  (309,'luke-montgomery'),
  (310,'james-thompson-jr'),
  (311,'kody-huisman'),
  (312,'preston-zachman'),
  (313,'miller-moss'),
  (314,'kevin-cline'),
  (315,'eric-gentry'),
  (316,'james-neal'),
  (317,'nolan-rucci'),
  (318,'tellek-lockette'),
  (319,'jack-pyburn'),
  (320,'dallen-bentley'),
  (321,'febechi-nwaiwu'),
  (322,'mason-reiger'),
  (323,'wesley-bailey'),
  (324,'jalen-walthall'),
  (325,'jeremiah-wright'),
  (326,'bryce-lance'),
  (327,'kobe-baynes'),
  (328,'joey-aguilar'),
  (329,'karon-prunty'),
  (330,'cian-slone'),
  (331,'nick-barrett'),
  (332,'nic-anderson'),
  (333,'landon-robinson'),
  (334,'jacob-de-jesus'),
  (335,'andre-fuller'),
  (336,'vincent-anthony'),
  (337,'chris-adams'),
  (338,'jeff-caldwell'),
  (339,'omar-aigbedion'),
  (340,'seydou-traore'),
  (341,'micah-morris'),
  (342,'josh-cuevas'),
  (343,'trey-smack'),
  (344,'nyjalik-kelly'),
  (345,'dan-villari'),
  (346,'jalon-daniels'),
  (347,'toriano-pride-jr'),
  (348,'jmond-tapp'),
  (349,'tommy-doman'),
  (350,'trey-white'),
  (351,'dillon-wade'),
  (352,'kansei-matsuzawa'),
  (353,'chip-trayanum'),
  (354,'gafa-faga'),
  (355,'rene-konga'),
  (356,'kam-dewberry'),
  (357,'carver-willis'),
  (358,'cole-payton'),
  (359,'romello-brinson'),
  (360,'caden-barnett'),
  (361,'fernando-carmona-jr'),
  (362,'henry-lutovsky'),
  (363,'malachi-lawrence'),
  (364,'caden-fordham'),
  (365,'treydan-stukes'),
  (366,'seth-mcgowan'),
  (367,'jacob-thomas'),
  (368,'isaiah-jatta'),
  (369,'kahlil-saunders'),
  (370,'aamil-wagner'),
  (371,'dj-rogers'),
  (372,'nick-andersen'),
  (373,'alzillion-hamilton'),
  (374,'knijeah-harris'),
  (375,'decarlos-nicholson'),
  (376,'noah-thomas'),
  (377,'micah-davey'),
  (378,'anthony-hankerson'),
  (379,'caleb-douglas'),
  (380,'jack-kelly'),
  (381,'sebastian-harsh'),
  (382,'caullin-lacy'),
  (383,'gunner-stockton'),
  (384,'emmanuel-henderson'),
  (385,'tyre-west'),
  (386,'xavian-sorey-jr'),
  (387,'lake-mcree'),
  (388,'dalton-johnson'),
  (389,'damonte-smith'),
  (390,'eli-raridon'),
  (391,'john-michael-gyllenborg'),
  (392,'cole-wisniewski'),
  (393,'davion-carter'),
  (394,'princewill-umanmielen'),
  (395,'desmond-reid'),
  (396,'brylan-green'),
  (397,'michael-heldman'),
  (398,'kaleb-elarms-orr'),
  (399,'clayton-smith'),
  (400,'david-gusta'),
  (401,'joe-fagnano'),
  (402,'markis-deal'),
  (403,'malcolm-dewalt-iv'),
  (404,'luke-lindenmeyer'),
  (405,'eli-heidenreich'),
  (406,'geno-vandemark'),
  (407,'clay-patterson'),
  (408,'star-thomas'),
  (409,'jaylon-guilbeau'),
  (410,'devonta-smith'),
  (411,'jayden-bellamy'),
  (412,'eddie-walls-iii'),
  (413,'brett-thorson'),
  (414,'nathan-voorhis'),
  (415,'dane-key'),
  (416,'karson-sharar'),
  (417,'rasheed-miller'),
  (418,'ryan-davis'),
  (419,'evan-beerntsen'),
  (420,'maverick-baranowski'),
  (421,'keyshawn-james-newby'),
  (422,'tomas-rimac'),
  (423,'skyler-thomas'),
  (424,'gabriel-benyard'),
  (425,'bruno-fina'),
  (426,'vinny-anthony-ii'),
  (427,'jaidyn-denis'),
  (428,'gabriel-brownlow-dindy'),
  (429,'jamal-haynes'),
  (430,'cam-rice'),
  (431,'devin-bale'),
  (432,'christian-alliegro'),
  (433,'tyler-duzansky'),
  (434,'alan-herron'),
  (435,'mohamed-toure'),
  (436,'kobe-prentice'),
  (437,'kentrel-bullock'),
  (438,'quintayvious-hutchins'),
  (439,'lance-heard'),
  (440,'jayven-williams'),
  (441,'latrell-mccutchin-sr'),
  (442,'brenen-thompson'),
  (443,'jalen-mcmurray'),
  (444,'tyreek-chappell'),
  (445,'robert-henry-jr'),
  (446,'max-tomczak'),
  (447,'daylan-carnell'),
  (448,'gus-zilinskas'),
  (449,'wade-woodaz'),
  (450,'mckale-boley'),
  (451,'isaiah-nwokobia'),
  (452,'cole-maynard'),
  (453,'mac-harris'),
  (454,'jeffrey-mba'),
  (455,'aidan-laros'),
  (456,'jaren-kanak'),
  (457,'howard-sampson'),
  (458,'garrett-digiorgio'),
  (459,'paul-rubelt'),
  (460,'carlos-allen-jr'),
  (461,'josh-kattus'),
  (462,'ryan-eckley'),
  (463,'kalil-alexander'),
  (464,'laith-marjan'),
  (465,'dreyden-norwood'),
  (466,'eric-mcalister'),
  (467,'chamon-metayer'),
  (468,'ethan-onianwa'),
  (469,'jager-burton'),
  (470,'dj-harvey'),
  (471,'avery-smith'),
  (472,'max-bredeson'),
  (473,'ahmaad-moses'),
  (474,'austin-leausa'),
  (475,'keeshawn-silver'),
  (476,'riley-mahlman'),
  (477,'davon-booth'),
  (478,'phillip-dunnam'),
  (479,'deshawn-rucker'),
  (480,'jeremiah-wilson'),
  (481,'dasan-mccullough'),
  (482,'matthew-hibner'),
  (483,'cameron-calhoun'),
  (484,'jaden-craig'),
  (485,'dominic-bailey'),
  (486,'aidan-hubbard'),
  (487,'tony-grimes'),
  (488,'jackson-carsello'),
  (489,'luke-basso'),
  (490,'dj-hicks'),
  (491,'trebor-pena'),
  (492,'avery-johnson'),
  (493,'jason-henderson'),
  (494,'junior-vandeross-iii'),
  (495,'jackie-marshall'),
  (496,'nasir-bowers'),
  (497,'hero-kanu'),
  (498,'gavin-gerhardt'),
  (499,'ben-bell'),
  (500,'bangally-kamara');

-- Step 2: Convert boards.prospect_ids from integer[] to text[]
ALTER TABLE boards ALTER COLUMN prospect_ids TYPE text[] USING prospect_ids::text[];

-- Step 3: Map old numeric strings to slugs in boards
UPDATE boards SET prospect_ids = (
  SELECT array_agg(m.slug ORDER BY ordinality)
  FROM unnest(boards.prospect_ids) WITH ORDINALITY AS elem(val, ordinality)
  JOIN id_map m ON m.old_id = elem.val::integer
)
WHERE prospect_ids IS NOT NULL AND array_length(prospect_ids, 1) > 0
  AND prospect_ids[1] ~ '^\d+$';

-- Step 4: Migrate admin_big_board.prospect_ids (jsonb array of numbers -> strings)
UPDATE admin_big_board SET prospect_ids = (
  SELECT jsonb_agg(m.slug ORDER BY ordinality)
  FROM jsonb_array_elements_text(admin_big_board.prospect_ids) WITH ORDINALITY AS elem(val, ordinality)
  JOIN id_map m ON m.old_id = elem.val::integer
)
WHERE prospect_ids IS NOT NULL AND jsonb_array_length(prospect_ids) > 0
  AND jsonb_typeof(prospect_ids->0) = 'number';

-- Step 6: Migrate admin_player_notes.prospect_id to text slug
DO $$
BEGIN
  IF EXISTS (
    SELECT 1 FROM information_schema.columns
    WHERE table_name = 'admin_player_notes' AND column_name = 'prospect_id'
    AND data_type IN ('integer', 'bigint', 'smallint')
  ) THEN
    ALTER TABLE admin_player_notes ALTER COLUMN prospect_id TYPE text USING prospect_id::text;
  END IF;
END $$;

UPDATE admin_player_notes SET prospect_id = m.slug
FROM id_map m
WHERE admin_player_notes.prospect_id = m.old_id::text;

-- Verify
SELECT 'boards' AS tbl, id, prospect_ids[1] AS first_id FROM boards LIMIT 3;
SELECT 'admin_big_board' AS tbl, board_name, prospect_ids->0 AS first_id FROM admin_big_board;
SELECT 'admin_player_notes' AS tbl, prospect_id FROM admin_player_notes LIMIT 5;
